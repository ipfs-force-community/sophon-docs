(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{415:function(s,a,e){"use strict";e.r(a);var t=e(17),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"how-to-use-sophon-messager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use-sophon-messager"}},[s._v("#")]),s._v(" How to use sophon messager")]),s._v(" "),e("p",[s._v("messager is a component used to manage local messages, with the purpose of saving address messages, managing message status, and controlling the frequency of push messages.")]),s._v(" "),e("h2",{attrs:{id:"getting-start"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getting-start"}},[s._v("#")]),s._v(" Getting start")]),s._v(" "),e("h3",{attrs:{id:"clone-this-git-repository-to-your-machine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clone-this-git-repository-to-your-machine"}},[s._v("#")]),s._v(" Clone this git repository to your machine")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/ipfs-force-community/sophon-messager.git\n")])])]),e("h3",{attrs:{id:"install-dependencies-and-build"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-dependencies-and-build"}},[s._v("#")]),s._v(" Install Dependencies and Build")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),e("h3",{attrs:{id:"run-messager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-messager"}},[s._v("#")]),s._v(" Run messager")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager run "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("options:\n  --auth-url           url "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" auth server\n  --auth-token         token "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" auth server\n  --node-url           url "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" connection lotus/venus\n  --node-token         token auth "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" lotus/venus\n  --db-type            "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" db to use. sqlite/mysql\n  --mysql-dsn          mysql connection string\n  --gateway-url        url "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" gateway server\n  --gateway-token      token "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" gateway server\n  --rate-limit-redis   limit flow using redis\n")])])]),e("h2",{attrs:{id:"commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commands"}},[s._v("#")]),s._v(" Commands")]),s._v(" "),e("h3",{attrs:{id:"message-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#message-commands"}},[s._v("#")]),s._v(" Message commands")]),s._v(" "),e("ol",[e("li",[s._v("search message")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg search --id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("list message")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg list\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# list messages with the same address")]),s._v("\n./sophon-messager msg list --from "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("update one filled message state")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg update_filled_msg --id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("update all filled message state")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg update_all_filled_msg\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("wait a message result by id")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"6"}},[e("li",[s._v("republish a message by id")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg republish "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"7"}},[e("li",[s._v("replace a message")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg replace --gas-feecap"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-feecap"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --gas-premium"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-premium"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --gas-limit"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-limit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --auto"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --max-fee"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("max-fee"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n./sophon-messager msg replace --gas-feecap"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-feecap"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --gas-premium"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-premium"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --gas-limit"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gas-limit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --auto"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --max-fee"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("max-fee"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("from"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("nonce"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"8"}},[e("li",[s._v("list failed messages, maybe signed message failed or gas estimate failed")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg list-fail\n")])])]),e("ol",{attrs:{start:"9"}},[e("li",[s._v("lists message that have not been chained for a period of time")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg list-blocked\n")])])]),e("ol",{attrs:{start:"10"}},[e("li",[s._v("manual mark error messages")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager msg mark-bad "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("message id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("h3",{attrs:{id:"address-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#address-commands"}},[s._v("#")]),s._v(" Address commands")]),s._v(" "),e("ol",[e("li",[s._v("search address")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager address search "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("list address")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager address list\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("reset address")])]),s._v(" "),e("blockquote",[e("p",[s._v("The nonce of the address is set to nonce on the chain, and all unchain messages are marked as failed messages")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager reset "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("forbidden address")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager address forbidden "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("activate a frozen address")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager address active "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"6"}},[e("li",[s._v("set the number of address selection messages")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager address set-sel-msg-num --num"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"7"}},[e("li",[s._v("set parameters related to address fee")])]),s._v(" "),e("blockquote",[e("p",[s._v("sophon-messager address set-fee-params [options] address")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# options")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --gas-overestimation value  Estimate the coefficient of gas (default: 0)")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --gas-feecap value          Gas feecap for a message (burn and pay to miner, attoFIL/GasUnit)")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --max-fee value             Spend up to X attoFIL for message")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --gas-over-premium value    Coefficient of gas premium (default: 0)")]),s._v("\n\n./sophon-messager address set-fee-params "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("h3",{attrs:{id:"shared-params-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#shared-params-commands"}},[s._v("#")]),s._v(" shared params commands")]),s._v(" "),e("ol",[e("li",[s._v("get shared params")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager share-params get\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("set shared params")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager share-params "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" --gas-over-estimation"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.25")]),s._v(" --gas-feecap"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" --max-fee"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7000000000000000"')]),s._v(" --sel-msg-num"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" --gas-over-premium "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("manual refresh shared params from DB")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager share-params refresh\n")])])]),e("h3",{attrs:{id:"node-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-commands"}},[s._v("#")]),s._v(" node commands")]),s._v(" "),e("ol",[e("li",[s._v("search node info by name")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager node search "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("add node info")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager node "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("node-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("node-url"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("node-token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("list node info")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager node list\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("del node info by name")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("./sophon-messager node del "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("h3",{attrs:{id:"log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#log"}},[s._v("#")]),s._v(" log")]),s._v(" "),e("ol",[e("li",[s._v("set log level")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# eg. trace,debug,info,warn|warning,error,fatal,panic")]),s._v("\n./sophon-messager log set-level\n")])])]),e("h3",{attrs:{id:"send-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#send-命令"}},[s._v("#")]),s._v(" send 命令")]),s._v(" "),e("blockquote",[e("p",[s._v("send message\nsophon-messager send [command options] [targetAddress] [amount]")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('   options:\n   --from value         optionally specify the address to send\n   --gas-premium value  specify gas price to use in AttoFIL (default: "0")\n   --gas-feecap value   specify gas fee cap to use in AttoFIL (default: "0")\n   --gas-limit value    specify gas limit (default: 0)\n   --method value       specify method to invoke (default: 0)\n   --params-json value  specify invocation parameters in json\n   --params-hex value   specify invocation parameters in hex\n')])])])])}),[],!1,null,null,null);a.default=r.exports}}]);