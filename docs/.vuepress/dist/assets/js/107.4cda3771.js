(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{484:function(e,a,s){"use strict";s.r(a);var t=s(17),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"venus-market-v2-miner用户指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-market-v2-miner用户指南"}},[e._v("#")]),e._v(" venus-market-v2 miner用户指南")]),e._v(" "),s("p",[e._v("venus-market v2支持两种运行模式")]),e._v(" "),s("ul",[s("li",[e._v("作为链服务运行模式")]),e._v(" "),s("li",[e._v("作为独立组件运行模式")])]),e._v(" "),s("p",[e._v("矿工搭建自己的venus-market只为自己服务, 推荐使用"),s("strong",[e._v("独立组件")]),e._v("模式, 如果你是一个链服务的提供者,\n需要使用venus-market搭建一个服务面向许多分散的旷工,需要使用链服务模式, 请参考"),s("RouterLink",{attrs:{to:"/zh/market/using-venus-market-for-master.html"}},[e._v("venus-market for master")])],1),e._v(" "),s("h3",{attrs:{id:"全局配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局配置"}},[e._v("#")]),e._v(" 全局配置")]),e._v(" "),s("p",[e._v("venus-market配置设置,配置文件目录为: "),s("code",[e._v("~/.venusmarket/config.toml")])]),e._v(" "),s("h4",{attrs:{id:"配置api端口监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置api端口监听"}},[e._v("#")]),e._v(" 配置API端口监听:")]),e._v(" "),s("p",[e._v("venus-market默认监听端口为本地端口, 所以其它组件与venus-maret不在同一机器, 需要修改API的监听端口:")]),e._v(" "),s("div",{staticClass:"language-yuml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[API]\nListenAddress = "/ip4/0.0.0.0/tcp/41235"\n')])])]),s("h4",{attrs:{id:"piecestorage存储模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#piecestorage存储模式"}},[e._v("#")]),e._v(" PieceStorage存储模式")]),e._v(" "),s("p",[e._v("目前venus-market支持两种Piece数据的存储模式:文件系统模式和对象存储服务模式,通过配置文件中的"),s("code",[e._v("PieceStorage")]),e._v("节来设置")]),e._v(" "),s("div",{staticClass:"language-yuml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[PieceStorage]\n  [PieceStorage.Fs]\n    Enable = false\n    Path = ""\n  [PieceStorage.S3]\n    Enable = true\n    EndPoint = "http://oss-cn-shanghai.aliyuncs.com/venus-market-test"\n    AccessKey = "LTAI5t6HiFgsqN6eVJ......"\n    SecretKey = "AlFNH9NakUsVjVRxMHaaYP7p......"\n    Token = ""\n')])])]),s("h4",{attrs:{id:"配置publishmsgperiod等待时间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置publishmsgperiod等待时间"}},[e._v("#")]),e._v(" 配置PublishMsgPeriod等待时间")]),e._v(" "),s("p",[e._v("venus-marke在收到market-client的订单时, 并不会马上就发布"),s("code",[e._v("ClientDealProposal")]),e._v("消息,会等待一定的周期, 这个周期是通过配置文件中的"),s("code",[e._v("PublishMsgPeriod")]),e._v("项来控制,在测试时可以将此项设置为较小值减少等待时间.下面的设置,将等待时间设置为10秒")]),e._v(" "),s("div",{staticClass:"language-yuml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('PublishMsgPeriod = "10s"\n')])])]),s("h3",{attrs:{id:"启动market服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动market服务"}},[e._v("#")]),e._v(" 启动market服务")]),e._v(" "),s("p",[e._v("旷工在启动自己的market时, 有两种方案可以选择")]),e._v(" "),s("ul",[s("li",[e._v("使用孵化器提供的venus节点 + venus-wallet")]),e._v(" "),s("li",[e._v("使用自己的venus全节点")])]),e._v(" "),s("h4",{attrs:{id:"使用venus-wallet作为签名服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用venus-wallet作为签名服务"}},[e._v("#")]),e._v(" 使用venus-wallet作为签名服务")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market solo-run --node-url"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/ip4/192.168.200.19/tcp/3453/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node-token"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiMS0xMjUiLCJwZXJtIjoic2lnbiIsImV4dCI6IiJ9.JenwgK0JZcxFDin3cyhBUN41VXNvYw-_0UUT2ZOohM0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --wallet-url"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/ip4/127.0.0.1/tcp/5678/http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --wallet-token"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.lE180EhNrEu1yGmnVEmT2vySD3UpiUU73kKTYpgQhJ0 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --piecestorage"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("fs:/Users/zl/Downloads/pieces_solo --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t01051:accountName\n")])])]),s("p",[e._v("参数说明:")]),e._v(" "),s("ul",[s("li",[e._v("node-url, 可以为自己的venus节点, 也可以是链服务的venus节点")]),e._v(" "),s("li",[e._v("node-token 分成两种情况\n"),s("ol",[s("li",[e._v("node-url为自己的节点, "),s("code",[e._v("node-token")]),e._v(" 直接通过"),s("code",[e._v("cat ~/.venus/token")]),e._v("命令获取")]),e._v(" "),s("li",[e._v("node-url为链服务组件的连接地址, "),s("code",[e._v("node-token")]),e._v("为"),s("code",[e._v("venus-auth")]),e._v("中授权账户的token.从链服务管理员处获取")])])]),e._v(" "),s("li",[e._v("wallet-url, wallet的url地址")]),e._v(" "),s("li",[e._v("wallet-token, 通过venus-wallet的命令查看:")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-wallet auth api-info --perm admin\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.lE180EhNrEu1yGmnVEmT2vySD3UpiUU73kKTYpgQhJ0:/ip4/127.0.0.1/tcp/5678/http\n")])])]),s("h4",{attrs:{id:"使用自己的venus节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用自己的venus节点"}},[e._v("#")]),e._v(" 使用自己的venus节点")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market solo-run --node-url"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/ip4/192.168.200.21/tcp/3454/ --node-token"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.OmJkVf10xXip7U0mSvX09gDG806tkFximCOrTxROIPg --piecestorage"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("fs:/Users/zl/Downloads/pieces_solo --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t01041:accountName\n")])])]),s("p",[e._v("参数说明:")]),e._v(" "),s("ul",[s("li",[e._v("node-url: venus全节点url")]),e._v(" "),s("li",[e._v("node-token: market 连接全节点时用于验证的token")]),e._v(" "),s("li",[e._v("piecestorage: 存储piece的路径,目前fs(文件系统)和oss(阿里云对象存储服务)两种\n"),s("ul",[s("li",[e._v("fs模式参数格式为:"),s("code",[e._v("fs:/mnt/piece")])]),e._v(" "),s("li",[e._v("对象存储模式参数的格式为:"),s("code",[e._v("s3:{access key}:{secret key}:{option token}@{region}host/{bucket}")])])])]),e._v(" "),s("li",[e._v("miner:指定旷工ID:账户")])]),e._v(" "),s("p",[e._v("💁:"),s("strong",[e._v("此时"),s("code",[e._v("node-token")]),e._v("为venus节点的本地token,在venus所在的机器上运行下面的命令来查看")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" ~/.venus/token\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.OmJkVf10xXip7U0mSvX09gDG806tkFximCOrTxROIPg\n")])])]),s("p",[e._v("这些参数既可以通过命令指定, 也能通过配置文件中的对应配置项来配置.")]),e._v(" "),s("p",[e._v("如果配置文件完全正确, 则可以直接下面的命令来启动:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market solo-run\n")])])]),s("p",[e._v("⚠️:"),s("strong",[e._v("独立模式下运行,是将venus节点作为签名服务, 所以在venus节点上需要提供miner的owner私钥")]),e._v("\n在venus上导入私钥:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus wallet "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("import")]),e._v(" private_key \n")])])]),s("p",[e._v("当miner使用venus-market作为代理时,需要将miner的"),s("code",[e._v("Multiaddrs")]),e._v("和"),s("code",[e._v("PeerID")]),e._v("设置为market的对应地址, 运行以下命令:")]),e._v(" "),s("ul",[s("li",[e._v("查看market的节点信息")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market net listen\n/ip4/127.0.0.1/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK\n/ip4/192.168.19.67/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK\n/ip6/::1/tcp/49770/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK\n")])])]),s("ul",[s("li",[e._v("设置miner的"),s("code",[e._v("Multiaddrs")])])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market actor set-addrs --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t01041 /ip4/192.168.19.67/tcp/58418/\nRequested multiaddrs change "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" message bafy2bzaceceqgxmiledunzjwbajpghzzn4iibvxhoifsrz4q2grzsirgznzdg\n")])])]),s("ul",[s("li",[e._v("设置miner的"),s("code",[e._v("peerid")]),e._v(":")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v(" ./venus-market actor set-peer-id --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("f01041 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK\n  Requested peerid change "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" message bafy2bzacea4ruzf4hvyezzhjkt6hnzz5tpk7ttuw6jmyoadqasqtujypqitp2\n")])])]),s("ul",[s("li",[e._v("等待消息在链上执行完成后, 查看命令可以查看miner的相关信息:")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market actor info --miner t01041\npeers: 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK\naddr: /ip4/192.168.19.67/tcp/58418\n")])])]),s("h3",{attrs:{id:"venus-sealer接入market"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-sealer接入market"}},[e._v("#")]),e._v(" venus-sealer接入market")]),e._v(" "),s("h4",{attrs:{id:"venus-sealer初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-sealer初始化"}},[e._v("#")]),e._v(" venus-sealer初始化")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer --network"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("force init --actor f01051 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--worker t3qyzbwduolr7xhbwyyojo3sopr573nu43l65aj65zdi7ic3bpv4mbmkefevpdcnjzvr4i4u4x3ihjue3pwccq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--owner t3qyzbwduolr7xhbwyyojo3sopr573nu43l65aj65zdi7ic3bpv4mbmkefevpdcnjzvr4i4u4x3ihjue3pwccq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--sector-size 8MiB "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--messager-url /ip4/192.168.200.21/tcp/39812 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--node-url"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/ip4/192.168.200.21/tcp/3454/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--gateway-url /ip4/192.168.200.21/tcp/45132 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--auth-token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--market-mode pool "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--market-url /ip4/127.0.0.1/tcp/41235 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--market-token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--no-local-storage\n")])])]),s("p",[e._v("参数说明:")]),e._v(" "),s("ul",[s("li",[e._v("actor 使用已经存在的旷工, 如果要创建新的旷工, 则不要设置此项")]),e._v(" "),s("li",[e._v("worker, owner 旷工的worker和owner地址")]),e._v(" "),s("li",[e._v("sector-size 旷工的sector size")]),e._v(" "),s("li",[e._v("messager-url venus-messager地址")]),e._v(" "),s("li",[e._v("node-url venus节点的url")]),e._v(" "),s("li",[e._v("gateway-url gateway组件的url")]),e._v(" "),s("li",[e._v("auth-token sealer访问链服务各个组件时验证权的token, 参考"),s("RouterLink",{attrs:{to:"/zh/market/using-venus-market-for-master.html#token配置"}},[e._v("token配置")])],1),e._v(" "),s("li",[e._v("market-url venus-market服务的url地址")]),e._v(" "),s("li",[e._v("market-mode 要接入的market运行模式,"),s("code",[e._v("solo")]),e._v("(独立组件模式)或者"),s("code",[e._v("pool")]),e._v("(链服务模式)")]),e._v(" "),s("li",[e._v("market-token 此时分为两个情况\n"),s("ol",[s("li",[e._v("market-mode为"),s("code",[e._v("pool")]),e._v(", 此时"),s("code",[e._v("market-token")]),e._v("不用填写. 会默认使用"),s("code",[e._v("auth-token")]),e._v("覆盖此设置")]),e._v(" "),s("li",[e._v("market-mode为"),s("code",[e._v("solo")]),e._v(", 此时"),s("code",[e._v("market-token")]),e._v("为venus-market服务的本地token,通过"),s("code",[e._v("cat ~/.venusmarket")]),e._v("命令查看.")])])])]),e._v(" "),s("h4",{attrs:{id:"启动venus-sealer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动venus-sealer"}},[e._v("#")]),e._v(" 启动venus-sealer")]),e._v(" "),s("p",[e._v("初始化完毕以后, 各项参数都已经默认写入了配置文件, 所以直接运行:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer run\n")])])]),s("p",[e._v("启动完成后, 需要为其设置seal目录和store目录\n设置seal目录:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer storage attach --init --store /path/store\n./venus-sealer storage attach --init --seal /path/seal\n")])])]),s("p",[e._v("查看是否成功:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer storage list\n264b51dd-da09-4945-a067-23b452814801:\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("###                                               ] 510.9 GiB/7.218 TiB 6%")]),e._v("\n\tUnsealed: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Sealed: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Caches: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Reserved: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" B\n\tWeight: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Use: Seal\n\tLocal: /path/seal\n\tURL: http://127.0.0.1:2345/remote\ndda7399c-fee1-4899-a9c0-0ea94d6d9d99:\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("###                                               ] 510.9 GiB/7.218 TiB 6%")]),e._v("\n\tUnsealed: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Sealed: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Caches: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Reserved: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" B\n\tWeight: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" Use: Store\n\tLocal: /path/store\n\tURL: http://127.0.0.1:2345/remote\n")])])]),s("h4",{attrs:{id:"对于已经初始化过的sealer想要接入market"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对于已经初始化过的sealer想要接入market"}},[e._v("#")]),e._v(" 对于已经初始化过的sealer想要接入market")]),e._v(" "),s("p",[e._v("在venus-sealer的配置文件中修改market相关配置项"),s("code",[e._v("MarketNode")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-yuml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[MarketNode]\n  Mode = "solo"\n  Url = "/ip4/127.0.0.1/tcp/41235"\n  Token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiTWFya2V0TG9jYWxUb2tlbiIsInBlcm0iOiJhZG1pbiIsImV4dCI6IiJ9.3Zb06umKhroUKtx60VHOs_lwwLOcRRQBZ9JmRvIl_mI"\n')])])]),s("p",[e._v("其中"),s("code",[e._v("Token")]),e._v("项的配置也是取决于"),s("code",[e._v("Mode")]),e._v("的具体值, 可以参考"),s("a",{attrs:{href:"#venus-sealer%E5%88%9D%E5%A7%8B%E5%8C%96"}},[e._v("venus-sealer初始化")]),e._v("中, "),s("code",[e._v("market-token")]),e._v("参数的设置方法.")]),e._v(" "),s("h3",{attrs:{id:"使用market为miner挂单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用market为miner挂单"}},[e._v("#")]),e._v(" 使用market为miner挂单")]),e._v(" "),s("p",[e._v("设置挂单信息:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market storage-deals set-ask --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t01041 --price"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(".02fil --verified-price"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(".01fil --min-piece-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("512b --max-piece-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("8M\n")])])]),s("p",[e._v("查看挂单信息:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market storage-deals get-ask --miner"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t01041\nPrice per GiB/Epoch  Verified  Min. Piece Size "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("padded"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  Max. Piece Size "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("padded"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  Expiry "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Epoch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  Expiry "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Appx. Rem. Time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  Seq. No.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.02")]),e._v(" FIL             "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.01")]),e._v(" FIL  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("512")]),e._v(" B                     "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v(" MiB                     "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("161256")]),e._v("          719h59m0s                 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n")])])]),s("p",[e._v("此时market作为独立组件运行就完成了.")]),e._v(" "),s("h3",{attrs:{id:"使用market-client开始存储订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用market-client开始存储订单"}},[e._v("#")]),e._v(" 使用market-client开始存储订单")]),e._v(" "),s("h4",{attrs:{id:"启动market-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动market-client"}},[e._v("#")]),e._v(" 启动market-client")]),e._v(" "),s("p",[e._v("启动market-client时需要连接一个venus全节点")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --node-url"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/ip4/192.168.200.21/tcp/3454 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  --auth-token"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.OmJkVf10xXip7U0mSvX09gDG806tkFximCOrTxROIPg\n  --addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("t1pwtw2c74ugrpqdx7xgwxv6wspqli7vnwby6y2hy\n")])])]),s("p",[e._v("启动参数说明:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("node-url")]),e._v("和"),s("code",[e._v("auth-token")]),e._v("分别为venus节点的地址和token, 获取token的方式和之前一样,运行命令"),s("code",[e._v("cat ~/.venus/token")])]),e._v(" "),s("li",[s("code",[e._v("addr")]),e._v(":存储客户的地址")])]),e._v(" "),s("h4",{attrs:{id:"发起线上订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发起线上订单"}},[e._v("#")]),e._v(" 发起线上订单")]),e._v(" "),s("ol",[s("li",[e._v("导入订单存储文件")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client data "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\nImport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1642491708527303001")]),e._v(", Root bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("发起询价")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client storage asks query f01041 \nAsk: t01041\nPrice per GiB: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.02")]),e._v(" FIL\nVerified Price per GiB: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.01")]),e._v(" FIL\nMax Piece size: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v(" MiB\nMin Piece size: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("512")]),e._v(" B\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("生成订单任务")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("/market-client storage deals init\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 输入需要存储的数据的cid, `./market-client data local`命令查看")]),e._v("\nData CID "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("from lotus client "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(": bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(" calculating data size\nPieceCid:  baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai  PayLoadSize: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("809")]),e._v(" PieceSize: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1024")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 输入数据存储周期")]),e._v("\nDeal duration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("days"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("180")]),e._v("\nMiner Addresses "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("f0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(" f0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(", none to find: f01051\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(" querying miner asks\n-----\nProposing from t16qnfduxzpneb2m3rbdasvhgk7rmmo32zpiypkaq\n\tBalance: "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("9499.999999856612207905")]),e._v(" FIL\nPiece size: 1KiB "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Payload size: 809B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nDuration: 4320h0m0s\nTotal price: ~0.0098876953124352 FIL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.000000019073486328")]),e._v(" FIL per epoch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nVerified: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 确认是否接受订单价格")]),e._v("\nAccept "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("yes/no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(": "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("yes")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(" executing\nDeal "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("t01051"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" CID: bafyreihiln2ha6eaaos7kuhwpnvjvjlxmjnpsklym6hhucu2z776bf2or4\n")])])]),s("p",[e._v("此时在venus-market的日志中可以看到关于订单的日志,其中有"),s("code",[e._v("PublishStorageDeals")]),e._v("消息的cid,可以在节点上查看消息状态:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T09:44:03.382+0800\tINFO\tstorageadapter\tstorageprovider/dealpublisher.go:258\t"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" deal with piece CID baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai to publish deals queue - "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" deals "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" queue "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("max queue size "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T09:44:03.382+0800\tINFO\tstorageadapter\tstorageprovider/dealpublisher.go:283\twaiting publish deals queue period of 10s before publishing\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T09:44:13.385+0800\tINFO\tstorageadapter\tstorageprovider/dealpublisher.go:298\tpublish deals queue period of 10s has expired, publishing deals\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T09:44:13.475+0800\tINFO\tstorageadapter\tstorageprovider/dealpublisher.go:386\tpublishing "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" deals "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" publish deals queue with piece CIDs: baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T09:44:14.658+0800\tWARN\tclients\tclients/mix_msgclient.go:92\tpush message bafy2bzaceaeqffghdahk3pgv5mixzwpym4rbo57yidb27l67kwoe36qwsn7pk to daemon\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[e._v("查看订单任务")])]),e._v(" "),s("p",[e._v("在market-client端查看:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client storage deals list\nDealCid      DealId  Provider  State                          On Chain?  Slashed?  PieceCID     Size    Price                    Duration  Verified\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".76bf2or4  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("       t01051    StorageDealCheckForAcceptance  N          N         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".dvowdiai  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1016")]),e._v(" B  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.00992212295525724")]),e._v(" FIL  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("520205")]),e._v("    "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n  Message: Provider state: StorageDealPublish\n")])])]),s("p",[e._v("在market端查看:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market storage-deals list\nProposalCid  DealId  State                  Client                                     Provider  Size  Price                     Duration\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".76bf2or4  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("       StorageDealPublishing  t16qnfduxzpneb2m3rbdasvhgk7rmmo32zpiypkaq  t01051    1KiB  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.00992212295525724")]),e._v(" FIL   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("520205")]),e._v("\n")])])]),s("p",[e._v("最后等待订单状态变化为"),s("code",[e._v("StorageDealAwaitingPreCommit")]),e._v(" 就可以进入"),s("a",{attrs:{href:"#venus-sealer%E5%B0%81%E8%A3%85%E6%89%87%E5%8C%BA"}},[e._v("封装扇区阶段")])]),e._v(" "),s("h4",{attrs:{id:"发起线下订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发起线下订单"}},[e._v("#")]),e._v(" 发起线下订单")]),e._v(" "),s("ol",[s("li",[e._v("导入订单存储文件")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./market-client data "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("import")]),e._v(" ./README.md\nImport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1642643014364955003")]),e._v(", Root bafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c\n")])])]),s("p",[e._v("2.转为CAR文件")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./market-client data generate-car ./README.md ./readme.md.car\n")])])]),s("p",[e._v("3.计算CAR文件的"),s("code",[e._v("CID")]),e._v("和"),s("code",[e._v("Piece size")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client data commP ./readme.md.car\nCID:  baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq\nPiece size:  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.969")]),e._v(" KiB\n")])])]),s("p",[e._v("4.发起订单")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./market-client storage deals init "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--manual-piece-cid"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--manual-piece-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4064")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\nbafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\nf01051 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(".01fil "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("518400")]),e._v("\nbafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm\n")])])]),s("ul",[s("li",[s("code",[e._v("manual-piece-cid")]),e._v(": 在第3步计执行"),s("code",[e._v("data commP")]),e._v("后输出的"),s("code",[e._v("CID")])]),e._v(" "),s("li",[s("code",[e._v("manual-piece-size")]),e._v(": 在第3步执行"),s("code",[e._v("data commP")]),e._v("后输出的"),s("code",[e._v("Piece size")]),e._v(".需要注意的是, 在使用这个参数时, 这个值需要转换成"),s("code",[e._v("byte")]),e._v("的大小, 在这里为3.969kib转换成byte的大小是4064.\n之后4个参数分别是:")]),e._v(" "),s("li",[e._v("第一步执行"),s("code",[e._v("import")]),e._v("命令后输入的"),s("code",[e._v("Root")])]),e._v(" "),s("li",[e._v("旷工ID")]),e._v(" "),s("li",[e._v("协商支付订单的费用"),s("code",[e._v("0.01fil")]),e._v(", **这个值必须大于旷工设置的"),s("code",[e._v("storage ask")]),e._v("中的最小值, 不然订单会被拒绝掉.")]),e._v(" "),s("li",[e._v("合约周期, 必须大于等于180天, 这个值也需要换成epoch为单位, 每个epoch=30秒, 示例中:518400 = 180天.")])]),e._v(" "),s("p",[e._v("最后的输出"),s("code",[e._v("bafyreidfs2w7lxacq6zpqck7q4zimyitidxyahojf7dbbuz5zr7irdlmqa")]),e._v("为propose的cid.\n线上订单一样, 此时可以通过market-client查看deal信息, 订单的最后状态会停止在"),s("code",[e._v("StorageDealWaitingForData")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client storage deals list\nDealCid      DealId  Provider  State                          On Chain?        Slashed?  PieceCID     Size       Price                    Duration  Verified  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".s7r6hftm  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("       t01051    StorageDealCheckForAcceptance  N                N         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".u7o3d6mq  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.969")]),e._v(" KiB  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5196.63")]),e._v(" FIL              "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("519663")]),e._v("    "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("     \n  Message: Provider state: StorageDealWaitingForData\n")])])]),s("p",[e._v("⚠️"),s("strong",[e._v("独此时关注market client的日志, 如果出现下面的内容:")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2022")]),e._v("-01-20T12:47:27.966+0800\tERROR\tstoragemarket_impl\tclientstates/client_states.go:324\tdeal bafyreif2k2e4acraxk33z3llwo5gqmk32tfrdj2kocjanojbfbf6vj72vm failed: adding market funds failed: estimating gas used: message execution failed: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" SysErrInsufficientFunds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),s("p",[e._v("说明market client的market余额不足,调用命令"),s("code",[e._v("./market-client actor-funds add 100fil")]),e._v("充值后重新执行命令.")]),e._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[e._v("导入离线订单的数据文件\n需要将之前第2步生成的"),s("code",[e._v(".car")]),e._v("文件线下传输到venus-market, 并通过venus-market命令导入数据:")])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-market storage-deals import-data bafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm ./readme.md.car\n")])])]),s("p",[e._v("再次查看状态, 订单状态更新为"),s("code",[e._v("StorageDealPublishing")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./market-client storage deals list\nDealCid      DealId  Provider  State                          On Chain?        Slashed?  PieceCID     Size       Price                    Duration  Verified  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".s7r6hftm  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("       t01051    StorageDealCheckForAcceptance  N                N         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".u7o3d6mq  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.969")]),e._v(" KiB  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5196.63")]),e._v(" FIL              "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("519663")]),e._v("    "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("     \nMessage: Provider state: StorageDealPublishing\n")])])]),s("p",[e._v("最后等待订单状态变化为"),s("code",[e._v("StorageDealAwaitingPreCommit")]),e._v(" 就可以进入"),s("a",{attrs:{href:"#venus-sealer%E5%B0%81%E8%A3%85%E6%89%87%E5%8C%BA"}},[e._v("封装扇区阶段")])]),e._v(" "),s("h4",{attrs:{id:"venus-sealer封装扇区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-sealer封装扇区"}},[e._v("#")]),e._v(" venus-sealer封装扇区")]),e._v(" "),s("p",[e._v("使用venus-sealer可以查询到这个订单的详细信息。")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./venus-sealer deals list\nDealId  PieceCID                                                          PieceSize  Client                                     Provider  StartEpoch  EndEpoch  Price        Verified  Packed  FastRetrieval  Status\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("36")]),e._v("      baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai  "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1024")]),e._v("       f16qnfduxzpneb2m3rbdasvhgk7rmmo32zpiypkaq  f01051    "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("102947")]),e._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("623152")]),e._v("    "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("19073486328")]),e._v("  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("     "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("   "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("           Undefine\n")])])]),s("p",[e._v("💁‍♂venus-sealer等待订单的时间也可以修改为10s，方便测试。")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[e._v('  WaitDealsDelay = "10s"\n')])])]),s("p",[e._v("封装deal有两种方式")]),e._v(" "),s("ul",[s("li",[e._v("直接执行"),s("code",[e._v("./venus-sealer sectors deal")]),e._v("将数据封装到一个新的扇区.")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./venus-sealer sectors deal\nAssign Deals "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("36")]),e._v(" sector "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v(" piece baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai offset "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" length "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1024")]),e._v("\n./sealer sectors list\nID  State          OnChain  Active  Expiration                    Deals  DealWeight\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("   PreCommitWait  NO       NO      n/a                           "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("0B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("ul",[s("li",[e._v("使用snapdeal的方式,将现有的cc-sector升级为真实数据的sector.过程如下:\n"),s("ol",[s("li",[e._v("首先查看sector 信息, 选择一个"),s("code",[e._v("State")]),e._v("为"),s("code",[e._v("Proving")]),e._v(","),s("code",[e._v("OnChain")]),e._v("状态为"),s("code",[e._v("YES")]),e._v(", "),s("code",[e._v("Active")]),e._v("为"),s("code",[e._v("YES")]),e._v("的sector.")])])])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer sectors list\nID  State              OnChain  Active  Expiration                    Deals  DealWeight\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("   Proving            YES      YES     "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1590156")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("in "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" year "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("23")]),e._v(" weeks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  CC\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("执行命令标记sector为"),s("code",[e._v("cc-update")])])]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./venus-sealer sectors snap-up "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("9")]),e._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("再次执行"),s("code",[e._v("sectors list")]),e._v("查看sector, 此时"),s("code",[e._v("state")]),e._v("会标记为"),s("code",[e._v("SnapDealsWaitDeals")])]),e._v(" "),s("li",[e._v("执行"),s("code",[e._v("./venus-sealer sectors deal")]),e._v("此时, "),s("code",[e._v("venus-sealer")]),e._v("会自动选择状态为"),s("code",[e._v("SnapDealsWaitDeals")]),e._v("升级为真实订单的扇区.")]),e._v(" "),s("li",[e._v("执行命令后, sector的会进入"),s("code",[e._v("UpdateReplica")]),e._v(", 生成新的证明参数文件, 进入"),s("code",[e._v("ProveReplicaUpdate")]),e._v("状态, 此过程如果使用GPU的情况需要20分钟左右;如果使用2*32核的CPU大概需要1小时20分钟.")]),e._v(" "),s("li",[e._v("成功完成以后, sector会发送"),s("code",[e._v("SubmitReplicaUpdate")]),e._v("消息, 然后等待消息"),s("code",[e._v("ReplicaUpdateWait")]),e._v(".")])]),e._v(" "),s("p",[e._v("💁‍♂ 提示:"),s("strong",[e._v("使用snapdeal的升级cc-sector要求机器至少有150G的内存.")])]),e._v(" "),s("p",[e._v("如果一切顺利, deal封装完成, "),s("code",[e._v("State")]),e._v("状态为"),s("code",[e._v("Proving")])]),e._v(" "),s("p",[e._v("⚠️:"),s("strong",[e._v("venus-market和sealer都有"),s("code",[e._v("PieceStorage")]),e._v("的配置项:")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("PieceStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("PieceStorage.Fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v('\n    Enable = true\n    Path = "/path/pieces_store"\n  '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("PieceStorage.S3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v('\n    Enable = false\n    EndPoint = ""\n    AccessKey = ""\n    SecretKey = ""\n    Token = ""\n')])])]),s("p",[e._v("在设置为"),s("code",[e._v("Fs")]),e._v("模式下,market和sealer的"),s("code",[e._v("Path")]),e._v("配置应该是指向的同一个物理机的同一个路径下.\n在测试时,如果没有指向同样的配置, 或者market和sealer不在同一个机器上也没有映射共享目录, sealer会找不到piece文件的.\n这种情况需要在开始封装扇区之前将market目录下的对应deal的piece文件拷贝到sealer的piece store目录中.")])])}),[],!1,null,null,null);a.default=n.exports}}]);