<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chain management | Sophon</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-RHJWEBDXVD"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RHJWEBDXVD');</script>
    <meta name="description" content="The Venus blockchain carries the information necessary to compute the current state of the network, is stored on disk and grows every 30 seconds with new blocks. This guide explains how to manage several aspects of th chain.">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.25d9a3a9.js" as="script"><link rel="preload" href="/assets/js/2.20e7910a.js" as="script"><link rel="preload" href="/assets/js/15.eb9a88a5.js" as="script"><link rel="prefetch" href="/assets/js/10.f067a250.js"><link rel="prefetch" href="/assets/js/11.2a60a7f2.js"><link rel="prefetch" href="/assets/js/12.0d1843dc.js"><link rel="prefetch" href="/assets/js/13.647f3f5f.js"><link rel="prefetch" href="/assets/js/14.b9b5b679.js"><link rel="prefetch" href="/assets/js/16.4b618857.js"><link rel="prefetch" href="/assets/js/17.931bbb8d.js"><link rel="prefetch" href="/assets/js/18.c2c0e919.js"><link rel="prefetch" href="/assets/js/19.eed8b7ce.js"><link rel="prefetch" href="/assets/js/20.8d8e80c0.js"><link rel="prefetch" href="/assets/js/21.db508f97.js"><link rel="prefetch" href="/assets/js/22.772ab990.js"><link rel="prefetch" href="/assets/js/23.24e15860.js"><link rel="prefetch" href="/assets/js/24.80fe4e98.js"><link rel="prefetch" href="/assets/js/25.e62fc7f6.js"><link rel="prefetch" href="/assets/js/26.1b7ca764.js"><link rel="prefetch" href="/assets/js/27.743db8d7.js"><link rel="prefetch" href="/assets/js/28.34c6cebb.js"><link rel="prefetch" href="/assets/js/29.d821c7da.js"><link rel="prefetch" href="/assets/js/3.f29ce1bd.js"><link rel="prefetch" href="/assets/js/30.51247c35.js"><link rel="prefetch" href="/assets/js/31.928af2d8.js"><link rel="prefetch" href="/assets/js/32.e6c58e13.js"><link rel="prefetch" href="/assets/js/33.cc495748.js"><link rel="prefetch" href="/assets/js/34.494c9b9f.js"><link rel="prefetch" href="/assets/js/35.3a2b7488.js"><link rel="prefetch" href="/assets/js/36.1fc7fd09.js"><link rel="prefetch" href="/assets/js/37.6429d423.js"><link rel="prefetch" href="/assets/js/38.be4ebdb7.js"><link rel="prefetch" href="/assets/js/39.d2bdf8a7.js"><link rel="prefetch" href="/assets/js/4.06777882.js"><link rel="prefetch" href="/assets/js/40.d5ceca79.js"><link rel="prefetch" href="/assets/js/41.46e90520.js"><link rel="prefetch" href="/assets/js/42.366ee090.js"><link rel="prefetch" href="/assets/js/43.189c319f.js"><link rel="prefetch" href="/assets/js/44.de286d60.js"><link rel="prefetch" href="/assets/js/45.5b52a7a3.js"><link rel="prefetch" href="/assets/js/46.00c209f9.js"><link rel="prefetch" href="/assets/js/47.7efeb0db.js"><link rel="prefetch" href="/assets/js/48.e9166cae.js"><link rel="prefetch" href="/assets/js/49.72eb7877.js"><link rel="prefetch" href="/assets/js/5.d51f6b5b.js"><link rel="prefetch" href="/assets/js/50.c5966292.js"><link rel="prefetch" href="/assets/js/51.b0a11fc4.js"><link rel="prefetch" href="/assets/js/52.2c3b80a6.js"><link rel="prefetch" href="/assets/js/53.5c95fa52.js"><link rel="prefetch" href="/assets/js/54.e0a7db6f.js"><link rel="prefetch" href="/assets/js/55.b4a64b6e.js"><link rel="prefetch" href="/assets/js/56.7e714c58.js"><link rel="prefetch" href="/assets/js/57.bf067071.js"><link rel="prefetch" href="/assets/js/58.fd4b15cc.js"><link rel="prefetch" href="/assets/js/59.3b34bbd9.js"><link rel="prefetch" href="/assets/js/6.48d01579.js"><link rel="prefetch" href="/assets/js/60.d8bdb5a0.js"><link rel="prefetch" href="/assets/js/61.14db738e.js"><link rel="prefetch" href="/assets/js/62.73b8b964.js"><link rel="prefetch" href="/assets/js/63.03edaad6.js"><link rel="prefetch" href="/assets/js/64.df9ef46d.js"><link rel="prefetch" href="/assets/js/65.32d357b8.js"><link rel="prefetch" href="/assets/js/66.d264c8a7.js"><link rel="prefetch" href="/assets/js/7.451a0b7b.js"><link rel="prefetch" href="/assets/js/8.24c6bc48.js"><link rel="prefetch" href="/assets/js/9.2c386c15.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/sophon-icon.svg" alt="Sophon" class="logo"> <span class="site-name can-hide">Sophon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/" class="nav-link router-link-active">
  Introduction
</a></div><div class="nav-item"><a href="/ref/" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/chain-mng.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/intro/chain-mng.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/" class="nav-link router-link-active">
  Introduction
</a></div><div class="nav-item"><a href="/ref/" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/intro/chain-mng.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/intro/chain-mng.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/intro/" aria-current="page" class="sidebar-link">Overview</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/intro/deploy-a-cs.html" class="sidebar-link">Deploy a Sophon service</a></li><li><a href="/intro/join-a-cs.html" class="sidebar-link">Use a Sophon service</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Operations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/intro/chain-mng.html" aria-current="page" class="active sidebar-link">Chain management</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/intro/chain-mng.html#syncing" class="sidebar-link">Syncing</a></li><li class="sidebar-sub-header"><a href="/intro/chain-mng.html#compacting-the-chain-data" class="sidebar-link">Compacting the chain data</a></li></ul></li><li><a href="/intro/simple-load-balancing.html" class="sidebar-link">Simple load balancing</a></li><li><a href="/intro/ha.html" class="sidebar-link">High availability solution</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> Chain management</h1> <p>The Venus blockchain carries the information necessary to compute the current state of the network, is stored on disk and grows every 30 seconds with new blocks. This guide explains how to manage several aspects of th chain..</p> <h2 id="syncing"><a href="#syncing" class="header-anchor">#</a> Syncing</h2> <p>Venus will automatically sync to the latest <em>chain head</em> by:</p> <ul><li>Fetching the block headers from the current <em>head</em> down to the last synced epoch.</li> <li>Retrieving and verifying all the blocks from the last synced epoch to the current head.</li></ul> <p>Once Venus is synced, it will learn about new blocks as they are mined for every epoch via Pubsub, and verify them accordingly. Note that in Venus, every epoch might see a variable number of mined blocks.</p> <p>Filecoin's blockchain grows relatively fast, so a full sync will take long time. For this reason, Venus offers a faster way to sync via trusted state snapshots.</p> <h3 id="syncing-from-a-trusted-state-snapshot-mainnet"><a href="#syncing-from-a-trusted-state-snapshot-mainnet" class="header-anchor">#</a> Syncing from a trusted state snapshot (mainnet)</h3> <p>We recommend most users to perform the initial node sync from a minimal, lightweight snapshot. Trusted state snapshots do not contain the full chain and might not be suitable for nodes that need to perform queries against historical state information, like block explorers, but otherwise work for most users.</p> <p>A recent minimal trusted state chain snapshot is available <a href="https://fil-chain-snapshots-fallback.s3.amazonaws.com/mainnet/minimal_finality_stateroots_latest.car" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. We can instruct venus to start the daemon and directly import from the URL:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># The snapshot size is about 7GiB. This works for mainnet.</span>
venus daemon --import-snapshot https://fil-chain-snapshots-fallback.s3.amazonaws.com/mainnet/minimal_finality_stateroots_latest.car

<span class="token comment"># An alternative is to download first and use the file</span>
venus daemon --import-snapshot <span class="token operator">&lt;</span>filename.car<span class="token operator">&gt;</span>

<span class="token comment"># The sha256sum is stored alongside the interim snapshot and can be obtained via</span>
<span class="token function">curl</span> -sI https://fil-chain-snapshots-fallback.s3.amazonaws.com/mainnet/minimal_finality_stateroots_latest.car <span class="token punctuation">\</span>
<span class="token operator">|</span> perl -ne <span class="token string">'/^x-amz-website-redirect-location:(.+)\.car\s*$/ &amp;&amp; print &quot;<span class="token variable">$1</span>.sha256sum&quot;'</span> <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">curl</span> -s
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you do not trust the source of the snapshot or simply want Venus to validate the chain, you need to follow the steps in the next section. Complete validation of the chain is an order of magnitude slower, and is expected to take multiple days.</p></div> <h3 id="checking-sync-status"><a href="#checking-sync-status" class="header-anchor">#</a> Checking sync status</h3> <p>There are two ways to track whether the Venus daemon is correctly syncing the chain and how far it has yet to go to complete the syncing:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Inspect the current sync status, sync workers etc:</span>
venus <span class="token function">sync</span> status
<span class="token comment"># View the Timestamp of the chain head compared with the current time:</span>
venus chain <span class="token function">head</span>
</code></pre></div><h2 id="compacting-the-chain-data"><a href="#compacting-the-chain-data" class="header-anchor">#</a> Compacting the chain data</h2> <p>It is possible to <em>prune</em> the current chain data used by Venus to reduce the disk footprint of a Venus node by resyncing from a minimal snapshot.</p> <ol><li>Stop the Venus daemon:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>venus daemon stop
</code></pre></div><ol><li>Remove the contents of the <code>badger/</code> folder in the Venus path:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rm</span> -rf ~/.venus/badger/*
</code></pre></div><ol><li>Start the daemon using a minimal snapshot, as explained above:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>venus daemon --import-snapshot https://fil-chain-snapshots-fallback.s3.amazonaws.com/mainnet/minimal_finality_stateroots_latest.car
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipfs-force-community/sophon-docs/edit/main/docs/intro/chain-mng.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/30/2022, 7:25:21 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/intro/join-a-cs.html" class="prev">
        Use a Sophon service
      </a></span> <span class="next"><a href="/intro/simple-load-balancing.html">
        Simple load balancing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.25d9a3a9.js" defer></script><script src="/assets/js/2.20e7910a.js" defer></script><script src="/assets/js/15.eb9a88a5.js" defer></script>
  </body>
</html>
