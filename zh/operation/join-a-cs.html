<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>准备 | 智子</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/sophon-icon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-RHJWEBDXVD"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RHJWEBDXVD');</script>
    <meta name="description" content="智子，原Venus链服务，是一个Filecoin超级节点解决方案">
    
    <link rel="preload" href="/assets/css/0.styles.70d1da1f.css" as="style"><link rel="preload" href="/assets/js/app.6d887ed6.js" as="script"><link rel="preload" href="/assets/js/2.206212c0.js" as="script"><link rel="preload" href="/assets/js/56.82b5cebf.js" as="script"><link rel="prefetch" href="/assets/js/10.ae6cc38d.js"><link rel="prefetch" href="/assets/js/11.d3cf2b62.js"><link rel="prefetch" href="/assets/js/12.a5f6d3b9.js"><link rel="prefetch" href="/assets/js/13.9328c410.js"><link rel="prefetch" href="/assets/js/14.4f959383.js"><link rel="prefetch" href="/assets/js/15.6c14c6e1.js"><link rel="prefetch" href="/assets/js/16.9c32d203.js"><link rel="prefetch" href="/assets/js/17.53f23df1.js"><link rel="prefetch" href="/assets/js/18.8fb34d21.js"><link rel="prefetch" href="/assets/js/19.c23028b4.js"><link rel="prefetch" href="/assets/js/20.e8513d32.js"><link rel="prefetch" href="/assets/js/21.ada0d16f.js"><link rel="prefetch" href="/assets/js/22.fc213551.js"><link rel="prefetch" href="/assets/js/23.108bedf4.js"><link rel="prefetch" href="/assets/js/24.86b8b8d2.js"><link rel="prefetch" href="/assets/js/25.c73b15d5.js"><link rel="prefetch" href="/assets/js/26.64fdc079.js"><link rel="prefetch" href="/assets/js/27.b7b68aaf.js"><link rel="prefetch" href="/assets/js/28.593f71a7.js"><link rel="prefetch" href="/assets/js/29.9f46ea6c.js"><link rel="prefetch" href="/assets/js/3.65e8c087.js"><link rel="prefetch" href="/assets/js/30.c1f27128.js"><link rel="prefetch" href="/assets/js/31.d7b61896.js"><link rel="prefetch" href="/assets/js/32.60212d2c.js"><link rel="prefetch" href="/assets/js/33.017e2e08.js"><link rel="prefetch" href="/assets/js/34.a446a814.js"><link rel="prefetch" href="/assets/js/35.4f215e69.js"><link rel="prefetch" href="/assets/js/36.6fcb5d98.js"><link rel="prefetch" href="/assets/js/37.466a0672.js"><link rel="prefetch" href="/assets/js/38.5fbd760c.js"><link rel="prefetch" href="/assets/js/39.dbd7f960.js"><link rel="prefetch" href="/assets/js/4.045795a4.js"><link rel="prefetch" href="/assets/js/40.5214a06f.js"><link rel="prefetch" href="/assets/js/41.46aeccd8.js"><link rel="prefetch" href="/assets/js/42.124e9831.js"><link rel="prefetch" href="/assets/js/43.846e8ade.js"><link rel="prefetch" href="/assets/js/44.7bd09036.js"><link rel="prefetch" href="/assets/js/45.72bd798c.js"><link rel="prefetch" href="/assets/js/46.d1ac7183.js"><link rel="prefetch" href="/assets/js/47.4acf4fdc.js"><link rel="prefetch" href="/assets/js/48.58ee15c5.js"><link rel="prefetch" href="/assets/js/49.a90a1788.js"><link rel="prefetch" href="/assets/js/5.865e40af.js"><link rel="prefetch" href="/assets/js/50.fe3427bc.js"><link rel="prefetch" href="/assets/js/51.c0a569ad.js"><link rel="prefetch" href="/assets/js/52.a69b6e02.js"><link rel="prefetch" href="/assets/js/53.6f36163a.js"><link rel="prefetch" href="/assets/js/54.b4d7a5fb.js"><link rel="prefetch" href="/assets/js/55.ae74d506.js"><link rel="prefetch" href="/assets/js/57.1c1c8615.js"><link rel="prefetch" href="/assets/js/58.72955b35.js"><link rel="prefetch" href="/assets/js/59.1da8e55d.js"><link rel="prefetch" href="/assets/js/6.158a40a9.js"><link rel="prefetch" href="/assets/js/60.2015a821.js"><link rel="prefetch" href="/assets/js/61.f30f54f3.js"><link rel="prefetch" href="/assets/js/62.33a74a65.js"><link rel="prefetch" href="/assets/js/63.59944c47.js"><link rel="prefetch" href="/assets/js/64.e3934018.js"><link rel="prefetch" href="/assets/js/65.472dd0e6.js"><link rel="prefetch" href="/assets/js/66.992b0b97.js"><link rel="prefetch" href="/assets/js/67.61dd85e8.js"><link rel="prefetch" href="/assets/js/68.dc6d5940.js"><link rel="prefetch" href="/assets/js/69.349a7fbe.js"><link rel="prefetch" href="/assets/js/7.f9982426.js"><link rel="prefetch" href="/assets/js/70.9730ccec.js"><link rel="prefetch" href="/assets/js/8.531e5295.js"><link rel="prefetch" href="/assets/js/9.9f23c698.js">
    <link rel="stylesheet" href="/assets/css/0.styles.70d1da1f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/sophon-icon.png" alt="智子" class="logo"> <span class="site-name can-hide">智子</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  功能介绍
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link router-link-active">
  部署/运维
</a></div><div class="nav-item"><a href="/zh/developer/" class="nav-link">
  研发/设计
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/join-a-cs.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/join-a-cs.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  功能介绍
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link router-link-active">
  部署/运维
</a></div><div class="nav-item"><a href="/zh/developer/" class="nav-link">
  研发/设计
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/join-a-cs.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/join-a-cs.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/" aria-current="page" class="sidebar-link">部署前准备</a></li><li><a href="/zh/operation/deploy-a-cs.html" class="sidebar-link">部署智子服务</a></li><li><a href="/zh/operation/venus-run-in-docker.html" class="sidebar-link">使用 Docker 部署智子服务</a></li><li><a href="/zh/operation/join-a-cs.html" aria-current="page" class="active sidebar-link">使用智子服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/operation/join-a-cs.html#准备" class="sidebar-link">准备</a></li><li class="sidebar-sub-header"><a href="/zh/operation/join-a-cs.html#安装-启动-venus-wallet" class="sidebar-link">安装/启动 venus-wallet</a></li><li class="sidebar-sub-header"><a href="/zh/operation/join-a-cs.html#安装-启动-damocles" class="sidebar-link">安装/启动 damocles</a></li><li class="sidebar-sub-header"><a href="/zh/operation/join-a-cs.html#问题" class="sidebar-link">问题？</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>智子服务组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/venus-daemon.html" class="sidebar-link">venus daemon</a></li><li><a href="/zh/operation/sophon-auth.html" class="sidebar-link">sophon-auth</a></li><li><a href="/zh/operation/sophon-miner.html" class="sidebar-link">sophon-miner</a></li><li><a href="/zh/operation/sophon-messager.html" class="sidebar-link">sophon-messager</a></li><li><a href="/zh/operation/sophon-gateway.html" class="sidebar-link">sophon-gateway</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>配置文件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/sophon-auth-config.html" class="sidebar-link">sophon-auth</a></li><li><a href="/zh/operation/sophon-miner-config.html" class="sidebar-link">sophon-miner</a></li><li><a href="/zh/operation/sophon-messager-config.html" class="sidebar-link">sophon-messager</a></li><li><a href="/zh/operation/sophon-gateway-config.html" class="sidebar-link">sophon-gateway</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Wallet</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/venus-wallet-builtin.html" class="sidebar-link">venus wallet（内置）</a></li><li><a href="/zh/operation/venus-wallet.html" class="sidebar-link">venus-wallet（远程）</a></li><li><a href="/zh/operation/venus-wallet-signfilter.html" class="sidebar-link">venus-wallet 签名过滤器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/chain-mng.html" class="sidebar-link">链管理</a></li><li><a href="/zh/operation/simple-load-balancing.html" class="sidebar-link">简易负载均衡</a></li><li><a href="/zh/operation/ha.html" class="sidebar-link">高可用解决方案</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="准备"><a href="#准备" class="header-anchor">#</a> 准备</h2> <p>在深入部署您的挖矿操作之前，请确保您已完成以下步骤。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>建议您在部署到主网上之前在<code>calibration</code>网络中测试您的配置。</p></div> <h3 id="永久存储"><a href="#永久存储" class="header-anchor">#</a> 永久存储</h3> <p>选择您熟悉的网络文件系统（例如 NFS）并部署您的存储集群。</p> <h3 id="在共享模块中设置您的帐户"><a href="#在共享模块中设置您的帐户" class="header-anchor">#</a> 在共享模块中设置您的帐户</h3> <p>有两种方法可以配置您的帐户。</p> <h4 id="对于需接入共享模块的用户"><a href="#对于需接入共享模块的用户" class="header-anchor">#</a> 对于需接入共享模块的用户</h4> <p>如果您尝试连接到第三方托管的共享智子服务（链服务），你需要提供<strong>机房的公网地址段</strong>和<strong>Miner ID</strong>，并由管理员加入到服务访问白名单中。联系上述服务的管理员并让他们为您设置。</p> <h5 id="管理员会生成类似如下信息"><a href="#管理员会生成类似如下信息" class="header-anchor">#</a> 管理员会生成类似如下信息</h5> <p>主网接入 token 信息。</p> <h6 id="venus-wallet配置文件"><a href="#venus-wallet配置文件" class="header-anchor">#</a> venus-wallet配置文件:</h6> <p>#初始化<code>venus-wallet run</code>生成配置文件;
#修改最后几行: <code>.venus_wallet/config.toml</code></p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">APIRegisterHub</span><span class="token punctuation">]</span>
<span class="token key property">RegisterAPI</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/dns/gateway.xxxxxxxx.com/tcp/83/wss&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lxxxxx.MoaizhRLYe0IFq7QBxxxxxxxxxxxxx&quot;</span>
<span class="token key property">SupportAccounts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;xxxxx&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h6 id="damocles-manager配置文件"><a href="#damocles-manager配置文件" class="header-anchor">#</a> damocles-manager配置文件:</h6> <p>初始化<code>damocles-manager daemon init</code>生成配置文件;
修改<code>.damocles-manager/sector-manager.cfg</code>前面几行</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># Default config:</span>
<span class="token punctuation">[</span><span class="token table class-name">Common</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">Common.API</span><span class="token punctuation">]</span>
<span class="token key property">Chain</span> <span class="token punctuation">=</span> <span class="token string">&quot;/dns/node.xxxxxxxx.com/tcp/81/wss&quot;</span>
<span class="token key property">Messager</span> <span class="token punctuation">=</span> <span class="token string">&quot;/dns/messager.xxxxxxxx.com/tcp/82/wss&quot;</span>
<span class="token key property">Market</span> <span class="token punctuation">=</span> <span class="token string">&quot;/dns/market.xxxxxxxx.com/tcp/84/wss&quot;</span>
<span class="token key property">Gateway</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/dns/gateway.xxxxxxxx.com/tcp/83/wss&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lxxxxx.MoaizhRLYe0IFq7QBxxxxxxxxxxxxx&quot;</span>
<span class="token comment">#ChainEventInterval = &quot;1m0s&quot;</span>
</code></pre></div><p>除此之外，damocles-manager 还需要配置节点的 [[Miners]]、[Miners.Sector]、[Miners.Commitment.Pre]、[Miners.Commitment.Prove]、[Miners.PoSt] 和 [Miners.Proof] 信息。打开部份注释根据实际情况填写，可参考下文的<a href="#%E9%85%8D%E7%BD%AE-damocles-manager">配置 damocles-manager</a>。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>venus-wallet</code> 可以部署为链服务或者本地组件，具体取决于您的安全要求。</p></div> <h4 id="对于共享模块的管理员"><a href="#对于共享模块的管理员" class="header-anchor">#</a> 对于共享模块的管理员</h4> <p>如果您是托管共享 venus 模块的管理员，请使用以下命令注册各个集群。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建user,默认激活状态</span>
$ ./sophon-auth user <span class="token function">add</span> <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span>
<span class="token comment"># 激活user</span>
$ ./sophon-auth user update --name <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span> --state <span class="token number">1</span>
<span class="token comment"># 绑定节点号</span>
$ ./sophon-auth user miner <span class="token function">add</span> <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>MinerID<span class="token operator">&gt;</span>

<span class="token comment"># 为此账号分配token，用于接入服务层验证</span>
$ ./sophon-auth token gen --perm <span class="token function">write</span> <span class="token operator">&lt;</span>ACCOUNT_NAME<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>AUTH_TOKEN_FOR_ACCOUNT_NAME<span class="token operator">&gt;</span>
</code></pre></div><h3 id="软件依赖"><a href="#软件依赖" class="header-anchor">#</a> 软件依赖</h3> <p>在运行<code>Venus</code>之前，您需要安装<a href="https://lotus.filecoin.io/lotus/install/linux/#software-dependencies" target="_blank" rel="noopener noreferrer">这些<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>软件。（注：和 lotus 的软件依赖相同）</p> <h2 id="安装-启动-venus-wallet"><a href="#安装-启动-venus-wallet" class="header-anchor">#</a> 安装/启动 venus-wallet</h2> <p>下载并编译<code>Venus-wallet</code>的源代码。</p> <ul><li>首次编译</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-wallet.git
<span class="token comment"># change directory to venus-wallet</span>
$ <span class="token builtin class-name">cd</span> venus-wallet
$ <span class="token function">git</span> checkout <span class="token operator">&lt;</span>LATEST_RELEASE<span class="token operator">&gt;</span>
$ <span class="token function">make</span>
</code></pre></div><ul><li>曾经成功编译过</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># change directory to venus-wallet,switch to the incubation branch</span>
$ <span class="token function">git</span> fetch
$ <span class="token function">git</span> pull
</code></pre></div><p>在后台运行<code>venus-wallet</code>模块。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用 <code>tail -f wallet.log</code> 来监控钱包日志。</p></div> <p>为您的<code>venus-wallet</code>设置密码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet setpwd
Password:******
Enter Password again:******
Password <span class="token builtin class-name">set</span> successfully
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请备份您的密码并妥善保存，否则你将无法使用 wallet 相关的功能。每次 venus-wallet run 启动时带--password 标志会自动解锁钱包，如果没带，在 wallet 实例启动后你需要手动解锁：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet unlock
Password: 

<span class="token comment"># 查看解锁状态</span>
$ ./venus-wallet lock-state
wallet state: unlocked
</code></pre></div><p>在扇区封装的过程中需要调用 wallet 进行签名，如果不解锁，会导致签名失败，进而导致扇区任务失败。</p></div> <p>生成 owner 和 worker 地址。（如果您没有现有的 miner ID）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet new bls
<span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>WORKER_ADDRESS<span class="token operator">&gt;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果您在<code>Calibration</code>上进行测试，则必须使用来自水龙头的测试币为您的所有地址提供资金。对于校准网，请使用此<a href="https://faucet.calibration.fildev.network/funds.html" target="_blank" rel="noopener noreferrer">水龙头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <p><em><strong>配置 venus-wallet 接入共享服务，使用您从共享模块管理员处获得的帐号信息更改 <code>~/.venus_wallet/config.toml</code>中的<code>[APIRegisterHub]</code> 部分</strong></em></p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">APIRegisterHub</span><span class="token punctuation">]</span>
<span class="token key property">RegisterAPI</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/ip4/&lt;IP_ADDRESS_OF_VENUS_GATEWAY&gt;/tcp/45132&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;AUTH_TOKEN_FOR_ACCOUNT_NAME&gt;&quot;</span>
<span class="token key property">SupportAccounts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;ACCOUNT_NAME&gt;&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>重新启动<code>venus-wallet</code>以使更改生效。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># grep [PID] of venus-wallet process</span>
$ <span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> wallet
<span class="token comment"># kill the process and restart</span>
$ <span class="token function">kill</span> <span class="token punctuation">[</span>PID<span class="token punctuation">]</span>
$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><p>到sophon-gateway确认钱包。
查看哪些钱包连接过来。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./sophon-gateway wallet list

<span class="token punctuation">[</span>
 	<span class="token punctuation">{</span>
 		<span class="token string">&quot;Account&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;venus-test&quot;</span>,
 		<span class="token string">&quot;SupportAccounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
 			<span class="token string">&quot;venus-test&quot;</span>
 		<span class="token punctuation">]</span>,
 		<span class="token string">&quot;ConnectStates&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
 			<span class="token punctuation">{</span>
 				<span class="token string">&quot;Addrs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
 					<span class="token string">&quot;f3sqqttrfpchw6usau4e2lr7cb6jbkvbes2nxudf42kxxxxxxxxglnga&quot;</span>,
 					<span class="token string">&quot;f3slzp2qdxtw44l6decoutkzyc5l4xxxxxxxxxxxxxxxxxxxxxxxxxxa&quot;</span>
 				<span class="token punctuation">]</span>,
 				<span class="token string">&quot;ChannelId&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b210b25-d01b-4aa2-ac75-324c8b1815e9&quot;</span>,
 				<span class="token string">&quot;Ip&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;10.10.66.141:44486&quot;</span>,
 				<span class="token string">&quot;RequestCount&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
 				<span class="token string">&quot;CreateTime&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2023-07-26T16:55:42.286652971+08:00&quot;</span>
 			<span class="token punctuation">}</span>
 		<span class="token punctuation">]</span>
 	<span class="token punctuation">}</span>
 <span class="token punctuation">]</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>建议使用<code>systemd</code>或<code>supervisord</code>等线程控制。</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请确保 venus-wallet 处于 unlocked 状态，要么会在 Sealer 模块初始化时卡在 &quot;Waiting for confirmation&quot;，导致 miner 帐号生成不了。</p></div> <h2 id="安装-启动-damocles"><a href="#安装-启动-damocles" class="header-anchor">#</a> 安装/启动 damocles</h2> <p>下载代码。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/ipfs-force-community/damocles.git
</code></pre></div><p>编译<code>damocles</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> damocles
$ <span class="token function">git</span> checkout <span class="token operator">&lt;</span>LATEST_RELEASE<span class="token operator">&gt;</span>
$ <span class="token function">make</span> all
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>编译完成后，会在 ./dist/bin 目录下有<code>damocles-worker</code>和<code>damocles-manager</code>两个可执行文件。</p></div> <h3 id="damocles-manager"><a href="#damocles-manager" class="header-anchor">#</a> damocles-manager</h3> <p>初始化工作目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./dist/bin/damocles-manager daemon init
</code></pre></div><h3 id="创建矿工号-可选"><a href="#创建矿工号-可选" class="header-anchor">#</a> 创建矿工号（可选）</h3> <p>创建矿工号。（如果已经有矿工号可以跳过此步）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./damocles-manager util miner create 
--from<span class="token operator">=</span><span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span> 
--owner<span class="token operator">=</span><span class="token operator">&lt;</span>OWNER_ADDRESS<span class="token operator">&gt;</span> 
--worker<span class="token operator">=</span><span class="token operator">&lt;</span>WORKER_ADDRESS<span class="token operator">&gt;</span>
--sector-size<span class="token operator">=</span>32GiB
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用<code>--net</code>来选择网络，默认为主网。</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>成功创建矿工号会有类似以下日志输出：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2022</span>-05-09T07:29:51.325Z  INFO  cmd  internal/util_miner.go:242  miner actor: t01219 <span class="token punctuation">(</span>t2z4nnndtt2iuu57lq3ivor7xdvqwivwb5renrh3a<span class="token punctuation">)</span>  
<span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;512MiB&quot;</span>, <span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3wultr2i47m24ew2p3bskclnb4rtgmuwb6cwjleqbeu4ndqocx67635dibpsq3ugpbv5y7fpjlpxlmkqcgnva&quot;</span>, 
<span class="token string">&quot;actor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t01166&quot;</span>, <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3wultr2i47m24ew2p3bskclnb4rtgmuwb6cwjleqbeu4ndqocx67635dibpsq3ugpbv5y7fpjlpxlmkqcgnva&quot;</span>, 
<span class="token string">&quot;worker&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;t3wultr2i47m24ew2p3bskclnb4rtgmuwb6cwjleqbeu4ndqocx67635dibpsq3ugpbv5y7fpjlpxlmkqcgnva&quot;</span><span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="配置-damocles-manager"><a href="#配置-damocles-manager" class="header-anchor">#</a> 配置 damocles-manager</h3> <p>按需配置默认配置文件<code>~/.damocles-manager/sector-manager.cfg</code>。这里给出一份参考，详细配置说明可以参见<a href="https://damocles.venus-fil.io/zh/operation/" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Common</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">Common.API</span><span class="token punctuation">]</span>
  <span class="token comment"># 网关服务地址，必填项，字符串类型</span>
  <span class="token comment"># 根据所使用的服务实际情况填写</span>
  <span class="token comment"># 对于每一条信息，如果使用了合法的 &quot;{token}:{multiaddr}&quot; 格式，构造客户端时将使用本字段中提取的 token，否则使用通用 sophon-auth 产生的 token</span>
  <span class="token key property">Gateway</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/ip4/{api_host}/tcp/{api_port}&quot;</span><span class="token punctuation">]</span>

  <span class="token comment"># 链服务信息，可选项，字符串类型</span>
  <span class="token comment"># 根据所使用的服务实际情况填写</span>
  <span class="token comment"># 如果使用了合法的 &quot;{token}:{multiaddr}&quot; 格式，构造客户端时将使用本字段中提取的 token，否则使用通用 sophon-auth 产生的 token</span>
  <span class="token comment"># 如果不填写，会默认使用 Gateway 的地址和 token 作为链服务的入口 </span>
  <span class="token key property">Chain</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/{api_host}/tcp/{api_port}&quot;</span>

  <span class="token comment"># 消息服务信息，可选项，字符串类型</span>
  <span class="token comment"># 根据所使用的服务实际情况填写</span>
  <span class="token comment"># 如果使用了合法的 &quot;{token}:{multiaddr}&quot; 格式，构造客户端时将使用本字段中提取的 token，否则使用通用 sophon-auth 产生的 token</span>
  <span class="token comment"># 如果不填写，会默认使用 Gateway 的地址和 token 作为消息服务的入口 </span>
  <span class="token key property">Messager</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/{api_host}/tcp/{api_port}&quot;</span>

  <span class="token comment"># 市场服务信息，可选项，字符串类型</span>
  <span class="token comment"># 根据所使用的服务实际情况填写</span>
  <span class="token comment"># 如果使用了合法的 &quot;{token}:{multiaddr}&quot; 格式，构造客户端时将使用本字段中提取的 token，否则使用通用 sophon-auth 产生的 token</span>
  <span class="token comment"># 如果不填写，会默认使用 Gateway 的地址和 token 作为消息服务的入口 </span>
  <span class="token key property">Market</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/{api_host}/tcp/{api_port}&quot;</span>

  <span class="token comment"># 服务 sophon-auth 产生的 token，必填项，字符串类型</span>
  <span class="token comment"># 根据所使用的服务实际情况填写</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;{some token}&quot;</span>
   
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Common.PieceStores</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># 路径，必填项，字符串类型</span>
  <span class="token comment">#Path = &quot;{store_path}&quot;</span>
   
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Common.PersistStores</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># 名称，选填项，字符串类型</span>
  <span class="token key property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;{store_name1}&quot;</span>
  <span class="token comment"># 路径，必填项，字符串类型，建议使用绝对路径</span>
  <span class="token key property">Path</span> <span class="token punctuation">=</span> <span class="token string">&quot;{store_path1}&quot;</span>
   
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Common.PersistStores</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;{store_name2}&quot;</span>
  <span class="token key property">Path</span> <span class="token punctuation">=</span> <span class="token string">&quot;{store_path2}&quot;</span>
   
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Miners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># `SP` actor id，必填项，数字类型，t033680-&gt;33680</span>
  <span class="token key property">Actor</span> <span class="token punctuation">=</span> <span class="token number">33680</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Sector</span><span class="token punctuation">]</span>
    <span class="token comment"># 扇区起始编号，选填项，数字类型，默认值为 0</span>
    <span class="token key property">InitNumber</span> <span class="token punctuation">=</span> <span class="token number">0</span>
    <span class="token comment"># 扇区编号上限，选填项，数字类型，默认值为 null，表示无上限限制</span>
    <span class="token key property">MaxNumber</span> <span class="token punctuation">=</span> <span class="token number">1000000</span>
    <span class="token comment"># 是否允许分配扇区，选填项，布尔类型，默认值为 true，即开启分配</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token comment"># 真实订单</span>
    <span class="token key property">EnableDeals</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Commitment.Pre</span><span class="token punctuation">]</span>
    <span class="token comment"># 发送地址，必填项，地址类型，miner 的 worker 地址</span>
    <span class="token key property">Sender</span> <span class="token punctuation">=</span> <span class="token string">&quot;t3vi4amwofexsfpontn5g722psgikzochthhhu3ptvofzrqmgajs67gt5n2ririlc4hj667dvfsn3kmxiwgtya&quot;</span>
    <span class="token comment"># 单条提交消息的 Gas 估算倍数，选填项，浮点数类型，默认值为 1.2</span>
    <span class="token comment">#GasOverEstimation = 1.2</span>
    <span class="token comment"># 单条提交消息的 FeeCap 限制，选填项，FIL 值类型，默认值为 5 nanoFIL</span>
    <span class="token comment">#MaxFeeCap = &quot;5 nanoFIL&quot;</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Commitment.Pre.Batch</span><span class="token punctuation">]</span>
    <span class="token comment"># 是否启用聚合提交，选填项，布尔类型，默认值为 false，即不启用</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token comment"># 最小聚合条数，选填项，数字类型，默认值为 16，即最小聚合条数为 16 条</span>
    <span class="token comment">#Threshold = 16</span>
    <span class="token comment"># 最大等待时间，选填项，时间类型，默认值为 1h，即最大等待 1 小时</span>
    <span class="token comment">#MaxWait = &quot;1h0m0s&quot;</span>
    <span class="token comment"># 检查间隔，选填项，时间类型，默认值为 1min，即每隔 1min 检查一次是否满足聚合条件</span>
    <span class="token comment">#CheckInterval = &quot;1m0s&quot;</span>
    <span class="token comment"># 聚合提交消息的 Gas 估算倍数，选填项，浮点数类型，默认值为 1.2</span>
    <span class="token comment">#GasOverEstimation = 1.2</span>
    <span class="token comment"># 聚合提交消息的 FeeCap 限制，选填项，FIL 值类型，默认值为 5 nanoFIL</span>
    <span class="token comment">#MaxFeeCap = &quot;5 nanoFIL&quot;</span>
   
  <span class="token comment">#用于配置 ProveCommit 消息提交的策略，其配置项和作用与 Miners.Commitment.Pre 内的完全一致。</span>
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Commitment.Prove</span><span class="token punctuation">]</span>
    <span class="token key property">Sender</span> <span class="token punctuation">=</span> <span class="token string">&quot;t3vi4amwofexsfpontn5g722psgikzochthhhu3ptvofzrqmgajs67gt5n2ririlc4hj667dvfsn3kmxiwgtya&quot;</span>
    <span class="token comment">#GasOverEstimation = 1.2</span>
    <span class="token comment">#MaxFeeCap = &quot;5 nanoFIL&quot;</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Commitment.Prove.Batch</span><span class="token punctuation">]</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token comment">#Threshold = 16</span>
    <span class="token comment">#MaxWait = &quot;1h0m0s&quot;</span>
    <span class="token comment">#CheckInterval = &quot;1m0s&quot;</span>
    <span class="token comment">#GasOverEstimation = 1.2</span>
    <span class="token comment">#MaxFeeCap = &quot;5 nanoFIL&quot;</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.PoSt</span><span class="token punctuation">]</span>
    <span class="token comment"># 发送地址，必填项，地址类型</span>
    <span class="token key property">Sender</span> <span class="token punctuation">=</span> <span class="token string">&quot;t3vi4amwofexsfpontn5g722psgikzochthhhu3ptvofzrqmgajs67gt5n2ririlc4hj667dvfsn3kmxiwgtya&quot;</span>
    <span class="token comment"># 是否启用，选填项，布尔类型，默认值为 true</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token comment"># 是否对扇区文件进行强校验，选填项，布尔类型，默认值为 true</span>
    <span class="token comment"># 开启时，除了对文件存在性进行判断外，还会尝试读取部分信息，如元数据等</span>
    <span class="token comment">#StrictCheck = true</span>
    <span class="token comment"># WindowPoSt 消息的 Gas 估算倍数，选填项，浮点数类型，默认值为 1.2</span>
    <span class="token comment">#GasOverEstimation = 1.2</span>
    <span class="token comment"># WindowPoSt 消息的 FeeCap 限制，选填项，FIL 值类型，默认值为 5 nanoFIL</span>
    <span class="token comment">#MaxFeeCap = &quot;5 nanoFIL&quot;</span>
    <span class="token comment"># 消息的稳定高度，选填项，数字类型，默认值为 10</span>
    <span class="token comment">#Confidence = 10</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Proof</span><span class="token punctuation">]</span>
    <span class="token comment"># 是否启用，选填项，布尔类型，默认值为 false</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
   
  <span class="token punctuation">[</span><span class="token table class-name">Miners.Deal</span><span class="token punctuation">]</span>
    <span class="token comment"># 是否启用订单，选填项，布尔类型，默认值为 false</span>
    <span class="token key property">Enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</code></pre></div><p>启动<code>damocles-manager</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./dist/bin/damocles-manager --net<span class="token operator">=</span>cali daemon run --poster --miner --listen <span class="token number">0.0</span>.0.0:1789
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用<code>--net</code>来选择网络，默认为主网。</p></div> <h3 id="damocles-worker"><a href="#damocles-worker" class="header-anchor">#</a> damocles-worker</h3> <p>规划用于封装过程中数据的本地存储，并使用以下命令创建并初始化数据目录。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./dist/bin/damocles-worker store sealing-init -l <span class="token operator">&lt;</span>dir<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token operator">&lt;</span>dir<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">&lt;</span>dir<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> <span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">&gt;</span>
</code></pre></div><p>挂载持久化数据目录，并使用以下命令初始化数据目录。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./dist/bin/damocles-worker store file-init -l <span class="token operator">&lt;</span>dir<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
</code></pre></div><p>规划用于各封装阶段的 CPU 核、numa 区域等配置。按需完成配置文件。以下为<code>worker</code>配置例子，更详细的配置项、作用、配置方法可以参考<a href="/zh/cluster/Venus-Worker-c">这个</a>文档。</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">worker</span><span class="token punctuation">]</span>
  <span class="token comment"># 实例名，选填项，字符串类型，默认以连接 `damocles-manager` 所使用的网卡 IP 地址作为实例名</span>
  <span class="token comment"># name = &quot;bytest&quot;</span>
  <span class="token comment"># rpc 服务监听地址，选填项，字符串类型，默认为&quot;0.0.0.0&quot;，即监听本机所有地址</span>
  <span class="token comment"># rpc_server.host = &quot;0.0.0.0&quot;</span>
  <span class="token comment"># rpc 服务监听端口，选填项，数字类型，默认为 17890</span>
  <span class="token comment"># rpc_server.port = 17890</span>

<span class="token punctuation">[</span><span class="token table class-name">sector_manager</span><span class="token punctuation">]</span>
  <span class="token comment"># 构造 rpc 客户端时使用的连接地址，必填项，字符串类型</span>
  <span class="token key property">rpc_client.addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/{some_ip}/tcp/1789&quot;</span>
  <span class="token comment"># rpc_client.headers = { User-Agent = &quot;jsonrpc-core-client&quot; }</span>
  <span class="token comment"># piece_token = &quot;{auth token}&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">sealing</span><span class="token punctuation">]</span>
  <span class="token comment"># 允许的`SP`，选填项，数字数组格式</span>
  <span class="token key property">allowed_miners</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token number">33680</span><span class="token punctuation">]</span>
  <span class="token comment"># 允许的扇区大小，选填项，字符串数组格式，[&quot;32GiB&quot;, &quot;64GiB&quot;]</span>
  <span class="token key property">allowed_sizes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;32GiB&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;64GiB&quot;</span><span class="token punctuation">]</span>
  <span class="token comment"># 是否允许向扇区内添加订单，选填项，布尔类型，默认为 false。</span>
  <span class="token comment"># 当设置为 true 时，通常需要同时设置 `sector_manager` 中的 `piece_token` 项</span>
  <span class="token comment"># enable_deals = true</span>
  <span class="token comment"># 封装过程中遇到 temp 类型的错误时，重试的次数，选填项，数字格式，默认为 5</span>
  <span class="token comment"># max_retries = 3</span>
  <span class="token comment"># 封装过程中遇到 temp 类型的错误时，重试的间隔，选填项，时间字符串格式，默认为“30s&quot;，即 30 秒</span>
  <span class="token comment"># seal_interval = &quot;30s&quot;</span>
  <span class="token comment"># 空闲的 `sealing_store` 申请封装任务的间隔，选填项，时间字符串格式，默认为”30s&quot;，即 30 秒</span>
  <span class="token comment"># recover_interval = &quot;30s&quot;</span>
  <span class="token comment"># rpc 状态轮询请求的间隔，选填项，时间字符串格式，默认为”30s&quot;，即 30 秒</span>
  <span class="token comment"># 封装过程中，部分环节使用了轮询方式来获取非实时的信息，如消息上链等。这个值有助于避免过于频繁的请求占用网络资源</span>
  <span class="token comment"># rpc_polling_interval = &quot;30s&quot;</span>
  <span class="token comment"># 是否跳过 proof 的本地校验环节，选填项，布尔格式，默认为 false</span>
  <span class="token comment"># ignore_proof_check = false</span>

<span class="token comment"># 根据实际资源规划</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># 扇区数据目录路径，必填项，字符串类型，建议使用绝对路径，数据目录和工作线程是一对一绑定的</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store1}&quot;</span>
  <span class="token comment"># 封装过程的定制参数，仅对当前工作线程生效</span>
  <span class="token comment"># sealing.allowed_miners = [10123, 10124, 10125]</span>
  <span class="token comment"># sealing.allowed_sizes = [&quot;32GiB&quot;, &quot;64GiB&quot;]</span>
  <span class="token comment"># sealing.enable_deals = true</span>
  <span class="token comment"># sealing.max_retries = 3</span>
  <span class="token comment"># sealing.seal_interval = &quot;30s&quot;</span>
  <span class="token comment"># sealing.recover_interval = &quot;30s&quot;</span>
  <span class="token comment"># sealing.rpc_polling_interval = &quot;30s&quot;</span>
  <span class="token comment"># sealing.ignore_proof_check = false</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store2}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store3}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store4}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store5}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store6}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store7}&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">sealing_thread</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to sealing store8}&quot;</span>

<span class="token comment"># attached 用于配置已完成的扇区持久化数据保存的位置，允许同时配置多个。</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">attached</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># 名称，选填项，字符串类型，默认为路径对应的绝对路径</span>
  <span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;bytest&quot;</span>
  <span class="token comment"># 路径，必填项，字符串类型，建议直接填写绝对路径</span>
  <span class="token key property">location</span> <span class="token punctuation">=</span> <span class="token string">&quot;/xx/xx/xxx&quot;</span>
  <span class="token comment"># 只读，选填项，布尔类型，默认值为 false</span>
  <span class="token comment">#readonly = false</span>

<span class="token punctuation">[</span><span class="token table class-name">processors.static_tree_d</span><span class="token punctuation">]</span>
  <span class="token key property">32GiB</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to static tree_d for 32GiB}&quot;</span>
  <span class="token key property">64GiB</span> <span class="token punctuation">=</span> <span class="token string">&quot;{path to static tree_d for 64GiB}&quot;</span>

<span class="token comment"># 根据实际资源规划</span>
<span class="token punctuation">[</span><span class="token table class-name">processors.limit</span><span class="token punctuation">]</span>
  <span class="token comment"># pc1 阶段的并发数限制，选填项，数字类型</span>
  <span class="token key property">pc1</span> <span class="token punctuation">=</span> <span class="token number">4</span>
  <span class="token comment"># pc2 阶段的并发数限制，选填项，数字类型</span>
  <span class="token key property">pc2</span> <span class="token punctuation">=</span> <span class="token number">2</span>
  <span class="token comment"># c2 阶段的并发数限制，选填项，数字类型</span>
  <span class="token key property">c2</span> <span class="token punctuation">=</span> <span class="token number">1</span>

<span class="token comment"># fields for pc1 processors</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token comment"># numa 亲和性分区 id，选填项，数字类型，默认值为 null，不会设置亲和性，需要根据宿主机的 numa 分区进行填写</span>
  <span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">0</span>
  <span class="token comment"># cpu 核绑定和限制选项，选填项，字符串类型，默认值为 null，不设置绑定，值的格式遵循标准 cgroup.cpuset 格式</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;0-7&quot;</span>
  <span class="token comment"># 声明本 processor 支持的最多并发量</span>
  <span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">2</span>
  <span class="token comment"># 外部执行器的附加环境变量，选填项，字典类型，默认值为 null</span>
  <span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">1</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;12-19&quot;</span>
  <span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">2</span>
  <span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;8-11,24-27&quot;</span>
  <span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_GPU_TREE_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;20-23,36-39&quot;</span>
  <span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_GPU_TREE_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.c2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;28-35&quot;</span>
  <span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;2,3&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.tree_d</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;40-45&quot;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>您也可以参考社区<code>damocles</code>性能测试的相关<a href="https://github.com/filecoin-project/venus/discussions/4866" target="_blank" rel="noopener noreferrer">技术文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，作为参考。</p></div> <p>使用启动<code>damocles-worker</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ /path/to/damocles-worker daemon -c /path/to/damocles-worker.toml
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>以上关于 sector-manager.cfg 和 venus-worker.toml 配置文件只是一份最简单的可运行配置，其他配置的详细信息可参<a href="/zh/cluster/">这些文档</a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>关于配置文件需要注意的是：<code>damocles-worker.toml</code>的<code>[[attached]]</code>中的<code>name = &quot;xxx&quot;</code> 和路径要与<code>sector-manager.cfg</code>中的<code>[[Common.PersistStores]] Name = &quot;xxx&quot;</code>和路径一致。</p></div> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题？</h2> <p>来<a href="https://filecoinproject.slack.com/archives/C028PCH8L31" target="_blank" rel="noopener noreferrer">Slack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上找我们吧！</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipfs-force-community/sophon-docs/edit/main/docs/zh/operation/join-a-cs.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2024/1/17 09:25:23</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/operation/venus-run-in-docker.html" class="prev">
        使用 Docker 部署智子服务
      </a></span> <span class="next"><a href="/zh/operation/venus-daemon.html">
        venus daemon
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6d887ed6.js" defer></script><script src="/assets/js/2.206212c0.js" defer></script><script src="/assets/js/56.82b5cebf.js" defer></script>
  </body>
</html>
